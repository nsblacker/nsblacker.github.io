<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic|Menlo:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="CoreData," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="CoreData与SQLite3
昨天被问到 SQLite3与Core Data有什么区别，当时只是想到了一个是充分利用了传统的SQL语句，另一个是充分利用了面向对象的编程方法，今天早上想了一会，决定以后再有人问我这个问题我就这么回答：
两个方法都可以完成IOS中数据持久化的任务，都是ORM（object－relationalmapping）关系－对象映射的解决方案">
<meta property="og:type" content="article">
<meta property="og:title" content="数据持久化:初识CoreData">
<meta property="og:url" content="http://yoursite.com/2016/06/22/数据持久化-初识CoreData/index.html">
<meta property="og:site_name" content="NSBlacker">
<meta property="og:description" content="CoreData与SQLite3
昨天被问到 SQLite3与Core Data有什么区别，当时只是想到了一个是充分利用了传统的SQL语句，另一个是充分利用了面向对象的编程方法，今天早上想了一会，决定以后再有人问我这个问题我就这么回答：
两个方法都可以完成IOS中数据持久化的任务，都是ORM（object－relationalmapping）关系－对象映射的解决方案">
<meta property="og:updated_time" content="2016-06-23T02:09:36.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="数据持久化:初识CoreData">
<meta name="twitter:description" content="CoreData与SQLite3
昨天被问到 SQLite3与Core Data有什么区别，当时只是想到了一个是充分利用了传统的SQL语句，另一个是充分利用了面向对象的编程方法，今天早上想了一会，决定以后再有人问我这个问题我就这么回答：
两个方法都可以完成IOS中数据持久化的任务，都是ORM（object－relationalmapping）关系－对象映射的解决方案">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"always"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>

  <title> 数据持久化:初识CoreData | NSBlacker </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">NSBlacker</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">此人决不闷骚</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                数据持久化:初识CoreData
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-06-22T12:53:23+08:00" content="2016-06-22">
              2016-06-22
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index">
                    <span itemprop="name">iOS</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/iOS/基础知识/" itemprop="url" rel="index">
                    <span itemprop="name">基础知识</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/06/22/数据持久化-初识CoreData/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/06/22/数据持久化-初识CoreData/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/06/22/数据持久化-初识CoreData/" class="leancloud_visitors" data-flag-title="数据持久化:初识CoreData">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="CoreData与SQLite3"><a href="#CoreData与SQLite3" class="headerlink" title="CoreData与SQLite3"></a>CoreData与SQLite3</h3><hr>
<p>昨天被问到 SQLite3与Core Data有什么区别，当时只是想到了一个是充分利用了传统的SQL语句，另一个是充分利用了面向对象的编程方法，今天早上想了一会，决定以后再有人问我这个问题我就这么回答：</p>
<p>两个方法都可以完成IOS中数据持久化的任务，都是ORM（object－relational<br>mapping）关系－对象映射的解决方案<a id="more"></a>，SQLIte3本身是一个数据存储的容器，搭配一套方法，单纯滴使用SQLite3类似Java 的MySQL＋JDBC，即有一个数据库的实体和一套控制数据库的方法，连接好就可以建立SQL语句，execute就可以了。SQLite3就是这样的，简单粗暴！   另一方面，Core Data是苹果推崇的方法，本身相当于一个库，提供了访问数据类和方法，那么数据存储的另一个要素——存储数据的容器是谁呢？自问自答：可以是二进制文件、xml，而且最重要的其实是SQLite3，不过这倒是没啥大不了的。</p>
<p>跑偏了！在Core Data提供的存储方法中，不再有数据表——&gt;字段的概念，取而代之的实体（Entity）——&gt;属性（Property）这个对应关系，字段中有value，type，取而代之的是Property中的Attributes（特性）中的attribute name，type （我这种分类应该是和别人的分类方法不一样，因为我想突出这里和数据库的对应关系，其实貌似没啥用呵呵）。而且在存储和访问的时候，通过KVC来从数据库中找到实体和特性，而且就是他们的名字！而且xcode中可视化添加实体和属性，类似phpadmin，但是CoreData能够把实体间的relationship直观表示出来。</p>
<p>（补充一句，上面说分类方式有些奇怪，是因为这个Property下面其实还有三个属性：Attributes，relationship，fetch property，由于后两者是关系和操作方面而非不是数据方面的，所以其实要是没有后两者，Attributes是可以作为Entity的直接下级的，Property存在的概念久淡化了）</p>
<p>所以，如果习惯用SQL语句就用SQLite3，如果喜欢用面向对象编程就用CoreData，不过有人说有些任务CoreData不能完成，这个我不清楚了，总之对我现在够用了。</p>
<h3 id="由一个例子入手"><a href="#由一个例子入手" class="headerlink" title="由一个例子入手"></a>由一个例子入手</h3><hr>
<p>1， Managed Object Model</p>
<p>Managed Object Model 是描述应用程序的数据模型，这个模型包含实体（Entity），特性（Property），读取请求（Fetch Request）等。（下文都使用英文术语。）</p>
<p>2，Managed Object Context</p>
<p>Managed Object Context 参与对数据对象（Managed Object）进行各种操作的全过程，并监测数据对象的变化，以提供对 undo/redo 的支持及更新绑定到数据的 UI。</p>
<p>3，Persistent Store Coordinator</p>
<p>Persistent Store Coordinator 相当于数据文件管理器，处理底层的对数据文件的读取与写入。一般我们无需与它打交道。在context的操作下，负责在数据库中生成取出managed object，或者将managed Object存到数据库</p>
<p>4，Managed Object</p>
<p>Managed Object 数据对象，与 Managed Object Context 相关联。</p>
<p>在水果教材上之前的例子中有几处问题没有懂，这个例子是又是贼简单——四个文本框，用户输入啥都行，home时开始存数据到数据库，重新active后读出数据再显示到textField上，说之前我把整段代码都贴上：</p>
<figure class="highlight m"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">//</span><br><span class="line">//  ViewController.m</span><br><span class="line">//  Test Core Data</span><br><span class="line">//</span><br><span class="line">//  Created by 你猜 on <span class="number">15</span>/<span class="number">11</span>/<span class="number">27</span>.</span><br><span class="line">//  Copyright © <span class="number">2015</span>年 你猜. All rights reserved.</span><br><span class="line">//</span><br><span class="line"></span><br><span class="line">#import <span class="string">"ViewController.h"</span></span><br><span class="line">#import <span class="string">"AppDelegate.h"</span></span><br><span class="line"></span><br><span class="line">static NSString *const kLineEntityName <span class="built_in">=</span> @<span class="string">"Line"</span>;</span><br><span class="line">static NSString *const kLineNumber <span class="built_in">=</span> @<span class="string">"lineNumber"</span>;</span><br><span class="line">static NSString *const kLineTextKey <span class="built_in">=</span> @<span class="string">"lineText"</span>;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">interface</span> ViewController ()</span><br><span class="line"></span><br><span class="line">@property (strong , nonatomic)IBOutletCollection(UITextField) NSArray *lineFields;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@<span class="keyword">implementation</span> ViewController</span><br><span class="line"></span><br><span class="line">- (void)viewDidLoad &#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">    // Do any additional setup after loading the view, typically from a nib.</span><br><span class="line">    //&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="number">1</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span><br><span class="line">    AppDelegate *appdDelegate <span class="built_in">=</span> [UIApplication sharedApplication].delegate;</span><br><span class="line">    NSManagedObjectContext *context <span class="built_in">=</span> [appdDelegate managedObjectContext];</span><br><span class="line">    NSFetchRequest *request <span class="built_in">=</span> [[NSFetchRequest alloc] initWithEntityName:kLineEntityName];//get table</span><br><span class="line">    </span><br><span class="line">    NSError *error;</span><br><span class="line">    NSArray *object <span class="built_in">=</span> [context executeFetchRequest:request error:&amp;error];</span><br><span class="line">    <span class="built_in">if</span>(object<span class="built_in">=</span><span class="built_in">=</span>nil)&#123;</span><br><span class="line">        NSLog(@<span class="string">"array id empty"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    for(NSManagedObject *oneObject in object)&#123;//get attribute in this table &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="number">2</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span><br><span class="line">        int lineNum <span class="built_in">=</span> [[oneObject valueForKey:kLineNumber] intValue];</span><br><span class="line">        NSString *lineText <span class="built_in">=</span> [oneObject valueForKey:kLineTextKey];</span><br><span class="line">        </span><br><span class="line">        UITextField *theField <span class="built_in">=</span> self.lineFields[lineNum];</span><br><span class="line">        theField.text <span class="built_in">=</span> lineText;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    UIApplication *app <span class="built_in">=</span> [UIApplication sharedApplication];</span><br><span class="line">    [[NSNotificationCenter defaultCenter]addObserver:self selector:@selector(applicationWillResignActive:) name:UIApplicationWillResignActiveNotification object:app ];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-(void)applicationWillResignActive:(NSNotification *)notification &#123;</span><br><span class="line"></span><br><span class="line">    AppDelegate *appDelegate <span class="built_in">=</span> [UIApplication sharedApplication].delegate;</span><br><span class="line">    NSManagedObjectContext *context <span class="built_in">=</span> [appDelegate managedObjectContext];</span><br><span class="line">    NSError *error;</span><br><span class="line">    for(int i <span class="built_in">=</span> <span class="number">0</span> ;i&lt;<span class="number">4</span> ; i++)&#123;</span><br><span class="line">        UITextField *theField <span class="built_in">=</span> self.lineFields[i];</span><br><span class="line">        </span><br><span class="line">        NSFetchRequest *request <span class="built_in">=</span> [[NSFetchRequest alloc]initWithEntityName:kLineEntityName];</span><br><span class="line">        NSPredicate *<span class="keyword">pred</span> <span class="built_in">=</span> [NSPredicate predicateWithFormat:@<span class="string">"(%K = %d)"</span>,kLineNumber,i];</span><br><span class="line">        [request setPredicate:<span class="keyword">pred</span>];</span><br><span class="line">        </span><br><span class="line">        NSArray *objects <span class="built_in">=</span> [context executeFetchRequest:request error:&amp;error];</span><br><span class="line">        <span class="built_in">if</span>(objects<span class="built_in">=</span><span class="built_in">=</span>nil)&#123;</span><br><span class="line">            NSLog(@<span class="string">"something is wrong!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        NSManagedObject *theLine <span class="built_in">=</span> nil;</span><br><span class="line">        <span class="built_in">if</span>([objects count] &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            theLine <span class="built_in">=</span> [objects objectAtIndex:<span class="number">0</span>];</span><br><span class="line">            </span><br><span class="line">        &#125;<span class="built_in">else</span>&#123;</span><br><span class="line">//&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="number">3</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span><br><span class="line"></span><br><span class="line"> theLine <span class="built_in">=</span> [NSEntityDescription </span><br><span class="line"> insertNewObjectForEntityForName:kLineEntityName inManagedObjectContext:context];                    </span><br><span class="line">&lt;span style<span class="built_in">=</span><span class="string">"white-space:pre"</span>&gt;	&lt;/span&gt;&#125;</span><br><span class="line">[theLine setValue:[NSNumber numberWithInt:i] forKey:kLineNumber];</span><br><span class="line">[theLine setValue:theField.text forKey:kLineTextKey];    </span><br><span class="line">   &#125;    </span><br><span class="line">[appDelegate saveContext];</span><br><span class="line">&#125;</span><br><span class="line">- (void)didReceiveMemoryWarning &#123;    [super didReceiveMemoryWarning];    // Dispose of any resources that can be recreated.</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>其实也没有啥，因为在编程中会用到的其实只有<font color="red">ManagedObjectContext</font>和<font color="blue">ManagedObject</font>（哦还有不在这里的<font color="green">NSFetchRequest</font>），下面我就想针对这三个类说一下：</p>
<p>对于小红（知道我说的谁吧）和小绿我想放到一起说，因为她俩是好朋友！看这么一段：<br><figure class="highlight m"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">AppDelegate *appdDelegate <span class="built_in">=</span> [UIApplication sharedApplication].delegate;</span><br><span class="line">NSManagedObjectContext *context <span class="built_in">=</span> [appdDelegate managedObjectContext];</span><br><span class="line">NSFetchRequest *request <span class="built_in">=</span> [[NSFetchRequest alloc] initWithEntityName:kLineEntityName];//get table</span><br><span class="line">    </span><br><span class="line">NSError *error;</span><br><span class="line">NSArray *object <span class="built_in">=</span> [context executeFetchRequest:request error:&amp;error];</span><br></pre></td></tr></table></figure></p>
<p>这里再补充点，在之前那篇介绍持久化的博客中，哐哐地把NSManagedObjectContext的定义都写了一遍，其实那个是在工程指定了要用Core Data后在AppDelegate中自动写好啦，前几天比较傻，现在有点豁然开朗的感觉，所以下觉心把这里好好写着。<br>说上面这段代码，我先把书上的原话码出来 “该方法首先获取对应用委托的引用，我们将使用这个引用获得我们创建的托管对象上下文” -_-#我擦这话组织的无可挑剔，就是完全不懂！ 我就理解：有了这两句后，这个context就牛逼了，为啥，因为他承载了APPDelegate中最少三个方法，所谓 “千言万语汇成一个变量”！这之后这个context就可以在本轮数据操作中如入无人之境，因为那三个方法已经把连接数据库，设置App代理完成了，以后就可配合其他参数（如小绿）任意操作数据了。</p>
<p>说完小红，说他的朋友小绿，申请了一个去查询变量，但是，要骑马要指定哪个实体。这里我只想说一个地儿，就是之前看到的声明NSFetchRequest，都跟着一堆，包括指出针对的实体，按照这种init的时候直接指出就好了，当然这里没有加任何谓词，有谓词的话还是要各种set的（比如最大查询条数、大小条件、某时间后等），还是要看本篇的姐妹篇。</p>
<p>哦对了，为啥说小红和小绿是好朋友呢？就是因为这句:</p>
<figure class="highlight m"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSArray *object <span class="built_in">=</span> [context executeFetchRequest:request error:&amp;error];</span><br></pre></td></tr></table></figure>
<p>这亲昵程度一目了然。<br>下面要结合这里说小蓝:<br><figure class="highlight m"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">NSArray *object <span class="built_in">=</span> [context executeFetchRequest:request error:&amp;error];</span><br><span class="line">    <span class="built_in">if</span>(object<span class="built_in">=</span><span class="built_in">=</span>nil)&#123;</span><br><span class="line">        NSLog(@<span class="string">"array id empty"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    for(NSManagedObject *oneObject in object)&#123;//get attribute in this table &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="number">2</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span><br></pre></td></tr></table></figure></p>
<p>这个object，其实是objects，因为这里存了不止一条查询结果。其实这部分我想说的重点是（这里本来想加一个“自认为是重点“来着，反正没人看索性有删掉了（这心理戏是有多足？））这个oneObject，  注意看他的类型——NSManagedObject！即这个变量存储了这个实体的所有attribute，性命、性别、年龄、所选课程组成的一条结果的所有信息都存在这个oneObject中，嗨就是数据库中的一行，取得时候直接用KVC：</p>
<p>NSString *name = [oneObject valueForKey:@”姓名”] ;</p>
<p>int age = [[oneObject valueForKey:@”年龄”] intValue];</p>
<figure class="highlight m"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> <span class="built_in">if</span>([objects count] &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            theLine <span class="built_in">=</span> [objects objectAtIndex:<span class="number">0</span>];</span><br><span class="line">            </span><br><span class="line">        &#125;<span class="built_in">else</span>&#123;</span><br><span class="line">//&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="number">3</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span><br><span class="line">            theLine <span class="built_in">=</span> [NSEntityDescription insertNewObjectForEntityForName:kLineEntityName inManagedObjectContext:context];                    </span><br><span class="line">&#125;</span><br><span class="line">[theLine setValue:[NSNumber numberWithInt:i] forKey:kLineNumber];</span><br><span class="line">[theLine setValue:theField.text forKey:kLineTextKey];</span><br></pre></td></tr></table></figure>
<p>至于这最后一处，就是insert的用法了，不是为了搜索数据。只要得到能控制数据的handler（我想这样称呼），用这个本来就是NSManagedObject实例的theLine变量正合适！按照KVC插入的原则插值就可以了。<br>貌似这里想说的就是这些，还有就是关于relationship和fetch property的，有机会聊。。。</p>
<p>最后的最后，还是直接把一直说的姊妹篇中说的那三个函数都贴到这里吧：</p>
<p>新建工程，如果选择了Core Data，会在AppDelegate中写好该写的；把Core Data的头文件链接进来；需要的framework也导入，系统自动写的代码如下：</p>
<figure class="highlight m"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">//</span><br><span class="line">//  AppDelegate.h</span><br><span class="line">//  Test Core Data</span><br><span class="line">//</span><br><span class="line">//  Created by 那强 on <span class="number">15</span>/<span class="number">11</span>/<span class="number">27</span>.</span><br><span class="line">//  Copyright © <span class="number">2015</span>年 那强. All rights reserved.</span><br><span class="line">//</span><br><span class="line"></span><br><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line">#import &lt;CoreData/CoreData.h&gt;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">interface</span> AppDelegate : UIResponder &lt;UIApplicationDelegate&gt;</span><br><span class="line"></span><br><span class="line">@property (strong, nonatomic) UIWindow *window;</span><br><span class="line"></span><br><span class="line">@property (readonly, strong, nonatomic) NSManagedObjectContext *managedObjectContext;</span><br><span class="line">@property (readonly, strong, nonatomic) NSManagedObjectModel *managedObjectModel;</span><br><span class="line">@property (readonly, strong, nonatomic) NSPersistentStoreCoordinator *persistentStoreCoordinator;</span><br><span class="line"></span><br><span class="line">- (void)saveContext;</span><br><span class="line">- (NSURL *)applicationDocumentsDirectory;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line">//</span><br><span class="line">//  AppDelegate.m</span><br><span class="line">//  Test Core Data</span><br><span class="line">//</span><br><span class="line">//  Created by 那强 on 15/11/27.</span><br><span class="line">//  Copyright © 2015年 那强. All rights reserved.</span><br><span class="line">//</span><br><span class="line"></span><br><span class="line">#import "AppDelegate.h"</span><br><span class="line"></span><br><span class="line">@interface AppDelegate ()</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation AppDelegate</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions &#123;</span><br><span class="line">    // Override point for customization after application launch.</span><br><span class="line">    return YES;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)applicationWillResignActive:(UIApplication *)application &#123;</span><br><span class="line">    // Sent when the application is about to move from active to inactive state. This can occur for certain types of temporary interruptions (such as an incoming phone call or SMS message) or when the user quits the application and it begins the transition to the background state.</span><br><span class="line">    // Use this method to pause ongoing tasks, disable timers, and throttle down OpenGL ES frame rates. Games should use this method to pause the game.</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)applicationDidEnterBackground:(UIApplication *)application &#123;</span><br><span class="line">    // Use this method to release shared resources, save user data, invalidate timers, and store enough application state information to restore your application to its current state in case it is terminated later.</span><br><span class="line">    // If your application supports background execution, this method is called instead of applicationWillTerminate: when the user quits.</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)applicationWillEnterForeground:(UIApplication *)application &#123;</span><br><span class="line">    // Called as part of the transition from the background to the inactive state; here you can undo many of the changes made on entering the background.</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)applicationDidBecomeActive:(UIApplication *)application &#123;</span><br><span class="line">    // Restart any tasks that were paused (or not yet started) while the application was inactive. If the application was previously in the background, optionally refresh the user interface.</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)applicationWillTerminate:(UIApplication *)application &#123;</span><br><span class="line">    // Called when the application is about to terminate. Save data if appropriate. See also applicationDidEnterBackground:.</span><br><span class="line">    // Saves changes in the application's managed object context before the application terminates.</span><br><span class="line">    [self saveContext];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - Core Data stack</span><br><span class="line"></span><br><span class="line">@synthesize managedObjectContext = _managedObjectContext;</span><br><span class="line">@synthesize managedObjectModel = _managedObjectModel;</span><br><span class="line">@synthesize persistentStoreCoordinator = _persistentStoreCoordinator;</span><br><span class="line"></span><br><span class="line">- (NSURL *)applicationDocumentsDirectory &#123;</span><br><span class="line">    // The directory the application uses to store the Core Data store file. This code uses a directory named "com.tcl.hello.Test_Core_Data" in the application's documents directory.</span><br><span class="line">    return [[[NSFileManager defaultManager] URLsForDirectory:NSDocumentDirectory inDomains:NSUserDomainMask] lastObject];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (NSManagedObjectModel *)managedObjectModel &#123;</span><br><span class="line">    // The managed object model for the application. It is a fatal error for the application not to be able to find and load its model.</span><br><span class="line">    if (_managedObjectModel != nil) &#123;</span><br><span class="line">        return _managedObjectModel;</span><br><span class="line">    &#125;</span><br><span class="line">    NSURL *modelURL = [[NSBundle mainBundle] URLForResource:@"Test_Core_Data" withExtension:@"momd"];</span><br><span class="line">    _managedObjectModel = [[NSManagedObjectModel alloc] initWithContentsOfURL:modelURL];</span><br><span class="line">    return _managedObjectModel;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (NSPersistentStoreCoordinator *)persistentStoreCoordinator &#123;</span><br><span class="line">    // The persistent store coordinator for the application. This implementation creates and returns a coordinator, having added the store for the application to it.</span><br><span class="line">    if (_persistentStoreCoordinator != nil) &#123;</span><br><span class="line">        return _persistentStoreCoordinator;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // Create the coordinator and store</span><br><span class="line">    </span><br><span class="line">    _persistentStoreCoordinator = [[NSPersistentStoreCoordinator alloc] initWithManagedObjectModel:[self managedObjectModel]];</span><br><span class="line">    NSURL *storeURL = [[self applicationDocumentsDirectory] URLByAppendingPathComponent:@"Test_Core_Data.sqlite"];</span><br><span class="line">    NSError *error = nil;</span><br><span class="line">    NSString *failureReason = @"There was an error creating or loading the application's saved data.";</span><br><span class="line">    if (![_persistentStoreCoordinator addPersistentStoreWithType:NSSQLiteStoreType configuration:nil URL:storeURL options:nil error:&amp;error]) &#123;</span><br><span class="line">        // Report any error we got.</span><br><span class="line">        NSMutableDictionary *dict = [NSMutableDictionary dictionary];</span><br><span class="line">        dict[NSLocalizedDescriptionKey] = @"Failed to initialize the application's saved data";</span><br><span class="line">        dict[NSLocalizedFailureReasonErrorKey] = failureReason;</span><br><span class="line">        dict[NSUnderlyingErrorKey] = error;</span><br><span class="line">        error = [NSError errorWithDomain:@"YOUR_ERROR_DOMAIN" code:9999 userInfo:dict];</span><br><span class="line">        // Replace this with code to handle the error appropriately.</span><br><span class="line">        // abort() causes the application to generate a crash log and terminate. You should not use this function in a shipping application, although it may be useful during development.</span><br><span class="line">        NSLog(@"Unresolved error %@, %@", error, [error userInfo]);</span><br><span class="line">        abort();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    return _persistentStoreCoordinator;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (NSManagedObjectContext *)managedObjectContext &#123;</span><br><span class="line">    // Returns the managed object context for the application (which is already bound to the persistent store coordinator for the application.)</span><br><span class="line">    if (_managedObjectContext != nil) &#123;</span><br><span class="line">        return _managedObjectContext;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    NSPersistentStoreCoordinator *coordinator = [self persistentStoreCoordinator];</span><br><span class="line">    if (!coordinator) &#123;</span><br><span class="line">        return nil;</span><br><span class="line">    &#125;</span><br><span class="line">    _managedObjectContext = [[NSManagedObjectContext alloc] initWithConcurrencyType:NSMainQueueConcurrencyType];</span><br><span class="line">    [_managedObjectContext setPersistentStoreCoordinator:coordinator];</span><br><span class="line">    return _managedObjectContext;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - Core Data Saving support</span><br><span class="line"></span><br><span class="line">- (void)saveContext &#123;</span><br><span class="line">    NSManagedObjectContext *managedObjectContext = self.managedObjectContext;</span><br><span class="line">    if (managedObjectContext != nil) &#123;</span><br><span class="line">        NSError *error = nil;</span><br><span class="line">        if ([managedObjectContext hasChanges] &amp;&amp; ![managedObjectContext save:&amp;error]) &#123;</span><br><span class="line">            // Replace this implementation with code to handle the error appropriately.</span><br><span class="line">            // abort() causes the application to generate a crash log and terminate. You should not use this function in a shipping application, although it may be useful during development.</span><br><span class="line">            NSLog(@"Unresolved error %@, %@", error, [error userInfo]);</span><br><span class="line">            abort();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>done!</p>

      
    </div>

    <div>
      
        
<div id="wechat_subscriber" style="display: block； padding: 10px 0; margin: 20px auto; width: 100%; text-align: center">
    <img id="wechat_subscriber_qcode" src="/uploads/wechat-qcode.jpg" alt="那强 wechat" style="width: 200px; max-width: 100%;"/>
    <div>加个微信 成为朋友吧</div>
</div>

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/CoreData/" rel="tag">#CoreData</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/06/19/Push-Notification（三）/" rel="next" title="Push_Notification（三）">
                <i class="fa fa-chevron-left"></i> Push_Notification（三）
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/06/22/数据持久化-概述/" rel="prev" title="数据持久化:概述">
                数据持久化:概述 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
        <div class="ds-share flat" data-thread-key="2016/06/22/数据持久化-初识CoreData/"
     data-title="数据持久化:初识CoreData"
     data-content=""
     data-url="http://yoursite.com/2016/06/22/数据持久化-初识CoreData/">
  <div class="ds-share-inline">
    <ul  class="ds-share-icons-16">

      <li data-toggle="ds-share-icons-more"><a class="ds-more" href="javascript:void(0);">分享到：</a></li>
      <li><a class="ds-weibo" href="javascript:void(0);" data-service="weibo">微博</a></li>
      <li><a class="ds-qzone" href="javascript:void(0);" data-service="qzone">QQ空间</a></li>
      <li><a class="ds-qqt" href="javascript:void(0);" data-service="qqt">腾讯微博</a></li>
      <li><a class="ds-wechat" href="javascript:void(0);" data-service="wechat">微信</a></li>

    </ul>
    <div class="ds-share-icons-more">
    </div>
  </div>
</div>
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2016/06/22/数据持久化-初识CoreData/"
           data-title="数据持久化:初识CoreData" data-url="http://yoursite.com/2016/06/22/数据持久化-初识CoreData/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/avatar.jpg"
               alt="那强" />
          <p class="site-author-name" itemprop="name">那强</p>
          <p class="site-description motion-element" itemprop="description">不问是非 只争高下</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">22</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">11</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">24</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/nsblacker" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/nq1991" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#CoreData与SQLite3"><span class="nav-number">1.</span> <span class="nav-text">CoreData与SQLite3</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#由一个例子入手"><span class="nav-number">2.</span> <span class="nav-text">由一个例子入手</span></a></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2015 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">那强</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"nsblackerhexo"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
  





  
  
  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("NrFrAP2G6o7Fkg5AMJ0fSXRR-gzGzoHsz", "OfSTWB6PxCBjmsEgmt5kxzYv");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  
<script type="text/javascript" async src="//push.zhanzhang.baidu.com/push.js">
</script>


</body>
</html>
